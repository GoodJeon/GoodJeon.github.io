---
layout: posts
comments: true
title: "[Pandas]내가 보려고 올린 Pandas 정리6"
categories: Python
tag: [python, 파이썬, pandas, 판다스, pd, 패키지]
toc: true
toc_sticky: true
date: 2022-01-14
last_modified_at: 2022-01-14

---

**[Noitce]** 고쳐야하거나 틀린 것이 있으면 말씀해주세요!
{: .notice--info}



<br>



**필요 모듈 호출**


```python
import pandas as pd
import numpy as np
```


```python
from IPython.core.interactiveshell import InteractiveShell
InteractiveShell.ast_node_interactivity="all"
```

---

# Pivoting

- 가지고 있는 데이터원본을 원하는 형태의 가공된 정보를 보여주는 것
  - 자료의 형태를 변경하기 위해 많이 사용하는 방법

![image](https://user-images.githubusercontent.com/75322297/149518966-713629cd-a050-4e1e-ae02-aec91d446644.png)

- 출처 : https://rfriend.tistory.com/275

## Pivoting Method

### 1) pivot( )

- pandas.pivot(data, index=None, columns=None, values=None)
- DataFrame.pivot(index=None, columns=None, values=None)

#### pivot() 사용예제


```python
# 데이터 생성
data = {
    "도시": ["서울", "서울", "서울", "부산", 
           "부산", "부산", "인천", "인천"],
    "연도": ["2015", "2010", "2005", "2015",
           "2010", "2005", "2015", "2010"],
    "인구": [9904312, 9631482, 9762546, 3448737,
           3393191, 3512547, 2890451, 263203],
    "지역": ["수도권", "수도권", "수도권", "경상권",
           "경상권", "경상권", "수도권", "수도권"]
}

columns = ["도시", "연도", "인구", "지역"]

df1 = pd.DataFrame(data, columns=columns)
df1
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>도시</th>
      <th>연도</th>
      <th>인구</th>
      <th>지역</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>서울</td>
      <td>2015</td>
      <td>9904312</td>
      <td>수도권</td>
    </tr>
    <tr>
      <th>1</th>
      <td>서울</td>
      <td>2010</td>
      <td>9631482</td>
      <td>수도권</td>
    </tr>
    <tr>
      <th>2</th>
      <td>서울</td>
      <td>2005</td>
      <td>9762546</td>
      <td>수도권</td>
    </tr>
    <tr>
      <th>3</th>
      <td>부산</td>
      <td>2015</td>
      <td>3448737</td>
      <td>경상권</td>
    </tr>
    <tr>
      <th>4</th>
      <td>부산</td>
      <td>2010</td>
      <td>3393191</td>
      <td>경상권</td>
    </tr>
    <tr>
      <th>5</th>
      <td>부산</td>
      <td>2005</td>
      <td>3512547</td>
      <td>경상권</td>
    </tr>
    <tr>
      <th>6</th>
      <td>인천</td>
      <td>2015</td>
      <td>2890451</td>
      <td>수도권</td>
    </tr>
    <tr>
      <th>7</th>
      <td>인천</td>
      <td>2010</td>
      <td>263203</td>
      <td>수도권</td>
    </tr>
  </tbody>
</table>

</div>




```python
# 각 도시에 대한 연도별 평균 인구
df1.pivot('도시', '연도', '인구')
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>연도</th>
      <th>2005</th>
      <th>2010</th>
      <th>2015</th>
    </tr>
    <tr>
      <th>도시</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>부산</th>
      <td>3512547.0</td>
      <td>3393191.0</td>
      <td>3448737.0</td>
    </tr>
    <tr>
      <th>서울</th>
      <td>9762546.0</td>
      <td>9631482.0</td>
      <td>9904312.0</td>
    </tr>
    <tr>
      <th>인천</th>
      <td>NaN</td>
      <td>263203.0</td>
      <td>2890451.0</td>
    </tr>
  </tbody>
</table>

</div>




```python
# 각 지역별 도시에 대한 연도별 평균 인구
df1.pivot(['지역','도시'], '연도', '인구')
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>연도</th>
      <th>2005</th>
      <th>2010</th>
      <th>2015</th>
    </tr>
    <tr>
      <th>지역</th>
      <th>도시</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>경상권</th>
      <th>부산</th>
      <td>3512547.0</td>
      <td>3393191.0</td>
      <td>3448737.0</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">수도권</th>
      <th>서울</th>
      <td>9762546.0</td>
      <td>9631482.0</td>
      <td>9904312.0</td>
    </tr>
    <tr>
      <th>인천</th>
      <td>NaN</td>
      <td>263203.0</td>
      <td>2890451.0</td>
    </tr>
  </tbody>
</table>

</div>



<br>

### 2) pivot_table( )

- **pivot_table(data, index=None, columns=None, values=None**,
  aggfunc='mean', fill_value=None, margins=False, dropna=True, margins_name='All', observed=False, sort=True)
  1. index :  **행 인덱스**로 들어갈 키열 또는 키열의 리스트
  2. columns : **열 인덱스**로 들어갈 키열 또는 키열의 리스트
  3. values : 분석할 데이터 프레임에서 분석할 열
  4. fill_value : NaN이 표출될 때 대체값 지정
  5. margins : 모든 데이터를 분석한 결과를 행으로 표출할 지 여부
  6. margins_name : margins가 표출될 때 그 열(행)의 이름


- 피봇테이블을 작성할 때 반드시 설정해야 되는 인수
  - data : 사용 데이터 프레임
  - index : 행 인덱스로 사용할 필드(기준 필드로 작용됨)
  - values : 인덱스 명을 제외한 나머지 값(data)은 수치 data 만 사용함
  - aggfunc: 기본 함수가 평균(mean)함수 이기 때문에 각 데이터의 평균값이 반환

#### pivot_table() 사용 예제


```python
import pandas as pd
import seaborn as sns

df = sns.load_dataset('titanic')[['age','sex','class','fare','survived']]
df.head()

```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>sex</th>
      <th>class</th>
      <th>fare</th>
      <th>survived</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>22.0</td>
      <td>male</td>
      <td>Third</td>
      <td>7.2500</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>38.0</td>
      <td>female</td>
      <td>First</td>
      <td>71.2833</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>26.0</td>
      <td>female</td>
      <td>Third</td>
      <td>7.9250</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>35.0</td>
      <td>female</td>
      <td>First</td>
      <td>53.1000</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>35.0</td>
      <td>male</td>
      <td>Third</td>
      <td>8.0500</td>
      <td>0</td>
    </tr>
  </tbody>
</table>

</div>




```python
# 선실 등급별 숙박객의 생존자 수
pd.pivot_table(df, index='class', columns='survived', values='sex', aggfunc='size')
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>survived</th>
      <th>0</th>
      <th>1</th>
    </tr>
    <tr>
      <th>class</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>First</th>
      <td>80</td>
      <td>136</td>
    </tr>
    <tr>
      <th>Second</th>
      <td>97</td>
      <td>87</td>
    </tr>
    <tr>
      <th>Third</th>
      <td>372</td>
      <td>119</td>
    </tr>
  </tbody>
</table>

</div>




```python
# 각 선실 등급별 숙박객의 생존자 수와 평균 나이
pd.pivot_table(df, index='class', columns='survived',
               values='age', aggfunc='mean')
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>survived</th>
      <th>0</th>
      <th>1</th>
    </tr>
    <tr>
      <th>class</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>First</th>
      <td>43.695312</td>
      <td>35.368197</td>
    </tr>
    <tr>
      <th>Second</th>
      <td>33.544444</td>
      <td>25.901566</td>
    </tr>
    <tr>
      <th>Third</th>
      <td>26.555556</td>
      <td>20.646118</td>
    </tr>
  </tbody>
</table>

</div>




```python
# 생존자/사망자의 최소, 최대 나이(성별별)
pd.pivot_table(df, index=['survived'], columns='sex',
               values=['age'], aggfunc=['min','max'])
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead tr th {
        text-align: left;
    }
    
    .dataframe thead tr:last-of-type th {
        text-align: right;
    }

</style>

<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="2" halign="left">min</th>
      <th colspan="2" halign="left">max</th>
    </tr>
    <tr>
      <th></th>
      <th colspan="2" halign="left">age</th>
      <th colspan="2" halign="left">age</th>
    </tr>
    <tr>
      <th>sex</th>
      <th>female</th>
      <th>male</th>
      <th>female</th>
      <th>male</th>
    </tr>
    <tr>
      <th>survived</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2.00</td>
      <td>1.00</td>
      <td>57.0</td>
      <td>74.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.75</td>
      <td>0.42</td>
      <td>63.0</td>
      <td>80.0</td>
    </tr>
  </tbody>
</table>

</div>



---

<br>

# Stacking & UnStacking

- 스태킹(stacking) : 컬럼 레이블과 그 값을 로우 인덱스와 값으로 회전시킴
- 언스태킹(unstacking) : 로우 인덱스와 그 값이 컬럼 레이블과 값으로 회전시킴

- DataFrame.unstack(level=- 1, fill_value=None)
  - level : int, str, list, default=-1
    - 언스태킹을 적용하는 레벨
    - 기본값은 마지막 레벨 : 언스태킹 결과 항상 마지막 레벨로 이동
  - fill_value : int, str or dict
    - 언스태킹 결과 결측치는 NaN으로 대체

- DataFrame.stack(level=- 1, dropna=True)
  - level : int, str, list, default=-1
    - 언스태킹을 적용하는 레벨
    - 기본값은 마지막 레벨 : 언스태킹 결과 항상 마지막 레벨로 이동
  - dropna : bool, default True
    - 스태킹 결과 결측치 처리 여부, 기본값은 True로 결측치 제외

![](C:/Users/513eh/Downloads/img/stacking.png)

## 1) Stacking

### 1. single level columns


```python
# single level columns
df = pd.DataFrame([[0, 1], [2, 3]],
                  index=['cat', 'dog'],
                  columns=['weight', 'height'])
df
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>weight</th>
      <th>height</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>cat</th>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>dog</th>
      <td>2</td>
      <td>3</td>
    </tr>
  </tbody>
</table>

</div>



**`⬇stacking⬇`**


```python
df.stack()
```




    cat  weight    0
         height    1
    dog  weight    2
         height    3
    dtype: int64



### 2. multi level columns1


```python
multicol = pd.MultiIndex.from_tuples([('weight','kg'),
                                      ('weight','pounds')])
df2 = pd.DataFrame([[0, 1], [2, 3]],
                  index=['cat', 'dog'],
                  columns=multicol)
df2

```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead tr th {
        text-align: left;
    }

</style>

<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="2" halign="left">weight</th>
    </tr>
    <tr>
      <th></th>
      <th>kg</th>
      <th>pounds</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>cat</th>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>dog</th>
      <td>2</td>
      <td>3</td>
    </tr>
  </tbody>
</table>

</div>



**`⬇stacking⬇`**


```python
# 마지막 레벨로 이동
df2.stack()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>weight</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">cat</th>
      <th>kg</th>
      <td>0</td>
    </tr>
    <tr>
      <th>pounds</th>
      <td>1</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">dog</th>
      <th>kg</th>
      <td>2</td>
    </tr>
    <tr>
      <th>pounds</th>
      <td>3</td>
    </tr>
  </tbody>
</table>

</div>



### 3. multi-level columns2


```python
multicol2 = pd.MultiIndex.from_tuples([('weight', 'kg'),
                                       ('height', 'm')])
df3 = pd.DataFrame([[None, 1.0], [2.0, 3.0]],
                     index=['cat', 'dog'],
                     columns=multicol2)
df3
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead tr th {
        text-align: left;
    }

</style>

<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th>weight</th>
      <th>height</th>
    </tr>
    <tr>
      <th></th>
      <th>kg</th>
      <th>m</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>cat</th>
      <td>NaN</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>dog</th>
      <td>2.0</td>
      <td>3.0</td>
    </tr>
  </tbody>
</table>

</div>



**`⬇stacking⬇`**


```python
# 스태킹 결과 마지막 레벨로 이동
df3.stack()

# 스태킹 결과 첫번째 레벨로 이동
df3.stack(0)

# 두 단계 레벨 모두 이동
df3.stack([0,1])
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>height</th>
      <th>weight</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>cat</th>
      <th>m</th>
      <td>1.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">dog</th>
      <th>kg</th>
      <td>NaN</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>m</th>
      <td>3.0</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>

</div>






<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>kg</th>
      <th>m</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>cat</th>
      <th>height</th>
      <td>NaN</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">dog</th>
      <th>height</th>
      <td>NaN</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>weight</th>
      <td>2.0</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>

</div>






    cat  height  m     1.0
    dog  height  m     3.0
         weight  kg    2.0
    dtype: float64




```python
# 스태킹 결과 결측치 행 포함
df3.stack(dropna=False)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>height</th>
      <th>weight</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">cat</th>
      <th>kg</th>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>m</th>
      <td>1.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">dog</th>
      <th>kg</th>
      <td>NaN</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>m</th>
      <td>3.0</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>

</div>




```python
# 스태킹 결과 결측치 행 삭제
df3.stack(dropna=True)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>height</th>
      <th>weight</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>cat</th>
      <th>m</th>
      <td>1.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">dog</th>
      <th>kg</th>
      <td>NaN</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>m</th>
      <td>3.0</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>

</div>



---

## 2. Unstacking


```python
index = pd.MultiIndex.from_tuples([('one', 'a'), ('one', 'b'),
                                   ('two', 'a'), ('two', 'b')])
s = pd.Series(np.arange(1.0, 5.0), index=index)
s

```




    one  a    1.0
         b    2.0
    two  a    3.0
         b    4.0
    dtype: float64



**`⬇unstacking⬇`**


```python
s.unstack() #default = level = -1
s.unstack(level=0) # 첫번째 레벨로
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>a</th>
      <th>b</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>one</th>
      <td>1.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>two</th>
      <td>3.0</td>
      <td>4.0</td>
    </tr>
  </tbody>
</table>

</div>






<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>one</th>
      <th>two</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a</th>
      <td>1.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>b</th>
      <td>2.0</td>
      <td>4.0</td>
    </tr>
  </tbody>
</table>

</div>



---

# Group Analysis

- 키에 의해서 결정되는 데이터가 여러 개 있는 경우 미리 지정한 연산을 통해 각 그룹 데이터의 대표값을 계산하는 것


- 만약 키가 지정하는 조건에 맞는 데이터가 하나 이상이라서 데이터 그룹을 이루는 경우에는 그룹의 특성을 보여주는 그룹분석을 해야 함

## 패턴

- 분할(SPLIT) : 어떤 기준에 따라 데이터셋을 작은 조각으로 분할한다
- 적용(APPLY) : 각 조각에 대해 독립적으로 연산을 수행한다
- 조합(COMBINE) : 모든 결과를 다시 하나의 단위로 조합한다

![](C:/Users/513eh/Downloads/img/groupby.png)

## 데이터 분할(split) 작업

- 판다스의 시리즈, 데이터프레임을 **groupby() 메소드**로 수행하며 그룹 객체에 대해 그룹연산을 수행
- 하나 이상의 **인덱스 레이블**이나 **컬럼(컬럼 리스트)**을 지정하여 이에 기초하여 연관된 값들이 그룹화 됨
- **GroupBy 클래스 객체 반환**
- **그룹 연산 메서드 사용 가능**
  ![image](https://user-images.githubusercontent.com/75322297/149522059-8b40b132-57b0-46e8-ba12-261a5d961807.png)

- 사진 출처 : https://pandas.pydata.org/docs/user_guide/groupby.html#aggregation

## 데이터 분할 후 작업

- 집계(aggregation) : 각 그룹의 아이템에 대한 평균이나 개수 계산
- 변형(transform) : 그룹이나 아이템에 특정적인 계산을 수행
- 필터링(filtering) : 그룹 단위의 계산에 기초해 불필요한 데이터 그룹 제거

---

<br>

![](C:/Users/513eh/Downloads/img/groupby2.png)

## 1. 데이터 분할

1. 단일 컬럼의 그룹화
2. 복수 컬럼의 그룹화
3. 인덱스 레벨을 이용한 그룹화

### 예제 데이터 준비


```python
data=pd.DataFrame({
    'key1':['A','A','B','B','A'] , 
    'key2': ['one', 'two', 'one', 'two' , 'one'],
    'data1':[1,2,3,4,5],
    'data2':[10,20,30,40,50]})
data

```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>key1</th>
      <th>key2</th>
      <th>data1</th>
      <th>data2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>A</td>
      <td>one</td>
      <td>1</td>
      <td>10</td>
    </tr>
    <tr>
      <th>1</th>
      <td>A</td>
      <td>two</td>
      <td>2</td>
      <td>20</td>
    </tr>
    <tr>
      <th>2</th>
      <td>B</td>
      <td>one</td>
      <td>3</td>
      <td>30</td>
    </tr>
    <tr>
      <th>3</th>
      <td>B</td>
      <td>two</td>
      <td>4</td>
      <td>40</td>
    </tr>
    <tr>
      <th>4</th>
      <td>A</td>
      <td>one</td>
      <td>5</td>
      <td>50</td>
    </tr>
  </tbody>
</table>

</div>



### 1) 단일 컬럼의 그룹화


```python
gr = data.groupby(data.key1) # key1 하나로
gr
```




    <pandas.core.groupby.generic.DataFrameGroupBy object at 0x0000024A8A28E370>



**groups 속성 : GroupBy object**

- 각 그룹의 이름을 키로 갖는 파이썬 딕셔너리를 반환
- 딕셔너리 값은 각 그룹에 속하는 인덱스 레이블의 배열
- Dict {group name -> group labels}


```python
gr.groups
gr.ngroups # ngroups는 groups의 수를 반환한다.
```




    {'A': [0, 1, 4], 'B': [2, 3]}






    2



**그룹화된 결과 접근**


```python
# 그룹 내용 출력함수 정의 
def print_groups(group_object):
    for name, group in group_object:
        print(name)
        print(group[:5])

```


```python
print_groups(gr)
```

    A
      key1 key2  data1  data2
    0    A  one      1     10
    1    A  two      2     20
    4    A  one      5     50
    B
      key1 key2  data1  data2
    2    B  one      3     30
    3    B  two      4     40


-> 각 그룹은 그룹명과 일치하는 값들의 로우들로 구성된 데이터프레임을 하나씩 포함하고 있음

**그룹정보 groups를 데이터프레임으로 저장**


```python
grDF = pd.DataFrame(gr)
grDF
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>A</td>
      <td>key1 key2  data1  data2
0    A  one      1  ...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>B</td>
      <td>key1 key2  data1  data2
2    B  one      3  ...</td>
    </tr>
  </tbody>
</table>

</div>



- 첫번째 그룹 정보


```python
grDF.loc[0]
grDF.loc[0].values
```




    0                                                    A
    1      key1 key2  data1  data2
    0    A  one      1  ...
    Name: 0, dtype: object






    array(['A',
             key1 key2  data1  data2
    0    A  one      1     10
    1    A  two      2     20
    4    A  one      5     50], dtype=object)



- 두번째 그룹 정보


```python
grDF.loc[1]
grDF.loc[1].values
```




    0                                                    B
    1      key1 key2  data1  data2
    2    B  one      3  ...
    Name: 1, dtype: object






    array(['B',
             key1 key2  data1  data2
    2    B  one      3     30
    3    B  two      4     40], dtype=object)



**메소드**


```python
gr.size() # 각 그룹의 크기 반환
gr.count() # 각 그룹의 컬럼별 아이템 개수 반환
groups.sum() # 각 그룹의 컬럼별 합계 반환
```




    key1
    A    3
    B    2
    dtype: int64






<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>key2</th>
      <th>data1</th>
      <th>data2</th>
    </tr>
    <tr>
      <th>key1</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>A</th>
      <td>3</td>
      <td>3</td>
      <td>3</td>
    </tr>
    <tr>
      <th>B</th>
      <td>2</td>
      <td>2</td>
      <td>2</td>
    </tr>
  </tbody>
</table>

</div>






<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>data1</th>
      <th>data2</th>
    </tr>
    <tr>
      <th>key1</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>A</th>
      <td>8</td>
      <td>80</td>
    </tr>
    <tr>
      <th>B</th>
      <td>7</td>
      <td>70</td>
    </tr>
  </tbody>
</table>

</div>



**선택한 컬럼에 대한 그룹별 합계 반환1**

- 그룹객체[컬럼명].sum()
- 그룹객체.sum()[컬럼명]
- 반환값은 시리즈 형식


```python
groups['data1'].sum() # groups.sum()['data1']
```




    key1
    A    8
    B    7
    Name: data1, dtype: int64



**선택한 컬럼에 대한 그룹별 합계 반환2**

- [컬럼명]리스트로 지정한 경우 : 데이터프레임 형식으로 반환
- 그룹객체[[컬럼명]].sum()
- 그룹객체.sum()[[컬럼명]]


```python
groups[['data1']].sum() # groups.sum()[['data1']]
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>data1</th>
    </tr>
    <tr>
      <th>key1</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>A</th>
      <td>8</td>
    </tr>
    <tr>
      <th>B</th>
      <td>7</td>
    </tr>
  </tbody>
</table>

</div>



### 2) 복수 컬럼의 그룹화

- .groupby( ) 메소드에 그룹명의 리스트를 전달하면 여러 컬럼에 대해 그룹화를 수행


```python
gr2 = data.groupby([data.key1, data.key2])
gr2
```




    <pandas.core.groupby.generic.DataFrameGroupBy object at 0x0000024A8A02A970>



**그룹정보, 그룹수 확인**


```python
gr2.groups # 복수 컬럼으로 된 그룹정보 : 튜플형태로 반환
gr2.ngroups
```




    {('A', 'one'): [0, 4], ('A', 'two'): [1], ('B', 'one'): [2], ('B', 'two'): [3]}






    4



**그룹정보 출력 : print_groups()함수 정의**


```python
print_groups(gr2)
```

    ('A', 'one')
      key1 key2  data1  data2
    0    A  one      1     10
    4    A  one      5     50
    ('A', 'two')
      key1 key2  data1  data2
    1    A  two      2     20
    ('B', 'one')
      key1 key2  data1  data2
    2    B  one      3     30
    ('B', 'two')
      key1 key2  data1  data2
    3    B  two      4     40


### 3) 인덱스 레벨을 이용한 그룹화

- 컬럼 대신 인덱스의 값을 사용해 그룹화

**예제 데이터**

- 계층형(멀티) 인덱스를 갖도록 데이터 구성 변경


```python
data
data2 = data.copy()
data2 = data2.set_index(['key1','key2'])
data2
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>key1</th>
      <th>key2</th>
      <th>data1</th>
      <th>data2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>A</td>
      <td>one</td>
      <td>1</td>
      <td>10</td>
    </tr>
    <tr>
      <th>1</th>
      <td>A</td>
      <td>two</td>
      <td>2</td>
      <td>20</td>
    </tr>
    <tr>
      <th>2</th>
      <td>B</td>
      <td>one</td>
      <td>3</td>
      <td>30</td>
    </tr>
    <tr>
      <th>3</th>
      <td>B</td>
      <td>two</td>
      <td>4</td>
      <td>40</td>
    </tr>
    <tr>
      <th>4</th>
      <td>A</td>
      <td>one</td>
      <td>5</td>
      <td>50</td>
    </tr>
  </tbody>
</table>

</div>






<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>data1</th>
      <th>data2</th>
    </tr>
    <tr>
      <th>key1</th>
      <th>key2</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">A</th>
      <th>one</th>
      <td>1</td>
      <td>10</td>
    </tr>
    <tr>
      <th>two</th>
      <td>2</td>
      <td>20</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">B</th>
      <th>one</th>
      <td>3</td>
      <td>30</td>
    </tr>
    <tr>
      <th>two</th>
      <td>4</td>
      <td>40</td>
    </tr>
    <tr>
      <th>A</th>
      <th>one</th>
      <td>5</td>
      <td>50</td>
    </tr>
  </tbody>
</table>

</div>



**레벨0(key1)을 사용해 그룹화**


```python
print_groups(data2.groupby(level=0))
```

    A
               data1  data2
    key1 key2              
    A    one       1     10
         two       2     20
         one       5     50
    B
               data1  data2
    key1 key2              
    B    one       3     30
         two       4     40


**레벨1(key2)을 사용해 그룹화**


```python
print_groups(data2.groupby(level=1))
```

    one
               data1  data2
    key1 key2              
    A    one       1     10
    B    one       3     30
    A    one       5     50
    two
               data1  data2
    key1 key2              
    A    two       2     20
    B    two       4     40


**예제 데이터 : iris**


```python
import seaborn as sns
iris = sns.load_dataset("iris")
```


```python
iris
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sepal_length</th>
      <th>sepal_width</th>
      <th>petal_length</th>
      <th>petal_width</th>
      <th>species</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>5.1</td>
      <td>3.5</td>
      <td>1.4</td>
      <td>0.2</td>
      <td>setosa</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4.9</td>
      <td>3.0</td>
      <td>1.4</td>
      <td>0.2</td>
      <td>setosa</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4.7</td>
      <td>3.2</td>
      <td>1.3</td>
      <td>0.2</td>
      <td>setosa</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4.6</td>
      <td>3.1</td>
      <td>1.5</td>
      <td>0.2</td>
      <td>setosa</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5.0</td>
      <td>3.6</td>
      <td>1.4</td>
      <td>0.2</td>
      <td>setosa</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>145</th>
      <td>6.7</td>
      <td>3.0</td>
      <td>5.2</td>
      <td>2.3</td>
      <td>virginica</td>
    </tr>
    <tr>
      <th>146</th>
      <td>6.3</td>
      <td>2.5</td>
      <td>5.0</td>
      <td>1.9</td>
      <td>virginica</td>
    </tr>
    <tr>
      <th>147</th>
      <td>6.5</td>
      <td>3.0</td>
      <td>5.2</td>
      <td>2.0</td>
      <td>virginica</td>
    </tr>
    <tr>
      <th>148</th>
      <td>6.2</td>
      <td>3.4</td>
      <td>5.4</td>
      <td>2.3</td>
      <td>virginica</td>
    </tr>
    <tr>
      <th>149</th>
      <td>5.9</td>
      <td>3.0</td>
      <td>5.1</td>
      <td>1.8</td>
      <td>virginica</td>
    </tr>
  </tbody>
</table>
<p>150 rows × 5 columns</p>

</div>



**픔종별로 그룹화**


```python
# iris 품종별로 그룹
igr = iris.groupby(iris.species)
igr
```




    <pandas.core.groupby.generic.DataFrameGroupBy object at 0x0000024A8A2ADFD0>



**품종별 합계 계산**


```python
igr.sum()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sepal_length</th>
      <th>sepal_width</th>
      <th>petal_length</th>
      <th>petal_width</th>
    </tr>
    <tr>
      <th>species</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>setosa</th>
      <td>250.3</td>
      <td>171.4</td>
      <td>73.1</td>
      <td>12.3</td>
    </tr>
    <tr>
      <th>versicolor</th>
      <td>296.8</td>
      <td>138.5</td>
      <td>213.0</td>
      <td>66.3</td>
    </tr>
    <tr>
      <th>virginica</th>
      <td>329.4</td>
      <td>148.7</td>
      <td>277.6</td>
      <td>101.3</td>
    </tr>
  </tbody>
</table>

</div>



**품종별 평균 계산**


```python
igr.mean()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sepal_length</th>
      <th>sepal_width</th>
      <th>petal_length</th>
      <th>petal_width</th>
    </tr>
    <tr>
      <th>species</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>setosa</th>
      <td>5.006</td>
      <td>3.428</td>
      <td>1.462</td>
      <td>0.246</td>
    </tr>
    <tr>
      <th>versicolor</th>
      <td>5.936</td>
      <td>2.770</td>
      <td>4.260</td>
      <td>1.326</td>
    </tr>
    <tr>
      <th>virginica</th>
      <td>6.588</td>
      <td>2.974</td>
      <td>5.552</td>
      <td>2.026</td>
    </tr>
  </tbody>
</table>

</div>



**품종별 기술통계**


```python
igr.describe()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead tr th {
        text-align: left;
    }
    
    .dataframe thead tr:last-of-type th {
        text-align: right;
    }

</style>

<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="8" halign="left">sepal_length</th>
      <th colspan="2" halign="left">sepal_width</th>
      <th>...</th>
      <th colspan="2" halign="left">petal_length</th>
      <th colspan="8" halign="left">petal_width</th>
    </tr>
    <tr>
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
      <th>count</th>
      <th>mean</th>
      <th>...</th>
      <th>75%</th>
      <th>max</th>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
    <tr>
      <th>species</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>setosa</th>
      <td>50.0</td>
      <td>5.006</td>
      <td>0.352490</td>
      <td>4.3</td>
      <td>4.800</td>
      <td>5.0</td>
      <td>5.2</td>
      <td>5.8</td>
      <td>50.0</td>
      <td>3.428</td>
      <td>...</td>
      <td>1.575</td>
      <td>1.9</td>
      <td>50.0</td>
      <td>0.246</td>
      <td>0.105386</td>
      <td>0.1</td>
      <td>0.2</td>
      <td>0.2</td>
      <td>0.3</td>
      <td>0.6</td>
    </tr>
    <tr>
      <th>versicolor</th>
      <td>50.0</td>
      <td>5.936</td>
      <td>0.516171</td>
      <td>4.9</td>
      <td>5.600</td>
      <td>5.9</td>
      <td>6.3</td>
      <td>7.0</td>
      <td>50.0</td>
      <td>2.770</td>
      <td>...</td>
      <td>4.600</td>
      <td>5.1</td>
      <td>50.0</td>
      <td>1.326</td>
      <td>0.197753</td>
      <td>1.0</td>
      <td>1.2</td>
      <td>1.3</td>
      <td>1.5</td>
      <td>1.8</td>
    </tr>
    <tr>
      <th>virginica</th>
      <td>50.0</td>
      <td>6.588</td>
      <td>0.635880</td>
      <td>4.9</td>
      <td>6.225</td>
      <td>6.5</td>
      <td>6.9</td>
      <td>7.9</td>
      <td>50.0</td>
      <td>2.974</td>
      <td>...</td>
      <td>5.875</td>
      <td>6.9</td>
      <td>50.0</td>
      <td>2.026</td>
      <td>0.274650</td>
      <td>1.4</td>
      <td>1.8</td>
      <td>2.0</td>
      <td>2.3</td>
      <td>2.5</td>
    </tr>
  </tbody>
</table>
<p>3 rows × 32 columns</p>

</div>



### 4) [ ] 연산자를 사용해 특정 컬럼에 대한 집계 연산 수행


```python
igr['sepal_length'].mean()
```




    species
    setosa        5.006
    versicolor    5.936
    virginica     6.588
    Name: sepal_length, dtype: float64




```python
igr[['sepal_length','petal_length']].mean()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sepal_length</th>
      <th>petal_length</th>
    </tr>
    <tr>
      <th>species</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>setosa</th>
      <td>5.006</td>
      <td>1.462</td>
    </tr>
    <tr>
      <th>versicolor</th>
      <td>5.936</td>
      <td>4.260</td>
    </tr>
    <tr>
      <th>virginica</th>
      <td>6.588</td>
      <td>5.552</td>
    </tr>
  </tbody>
</table>

</div>




```python
igr['petal_length'].describe()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
    <tr>
      <th>species</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>setosa</th>
      <td>50.0</td>
      <td>1.462</td>
      <td>0.173664</td>
      <td>1.0</td>
      <td>1.4</td>
      <td>1.50</td>
      <td>1.575</td>
      <td>1.9</td>
    </tr>
    <tr>
      <th>versicolor</th>
      <td>50.0</td>
      <td>4.260</td>
      <td>0.469911</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>4.35</td>
      <td>4.600</td>
      <td>5.1</td>
    </tr>
    <tr>
      <th>virginica</th>
      <td>50.0</td>
      <td>5.552</td>
      <td>0.551895</td>
      <td>4.5</td>
      <td>5.1</td>
      <td>5.55</td>
      <td>5.875</td>
      <td>6.9</td>
    </tr>
  </tbody>
</table>

</div>



---

## 2-1 그룹별 집계 함수

**GroupBy.그룹함수(func, *args, **kwargs)**

- func : 함수이름
  - 내장함수는 np.sum 또는 'sum'으로 지정, 사용자정의함수는 함수이름 그대로
- *args : 함수의 매개변수들
- **kwargs : 함수에 들어가는 키워드 인수들

### 1) agg(), aggregate()

#### 각 컬럼의 최대값과 최소값의 비율 계산

- 함수 peak_to_peak_ratio() 작성


```python
def peak_to_peak_ratio(x):
    return x.max() / x.min()
 # 함수 반환 값이 수치 스칼라 타입
 # 최대값과 최소값의 비율 계산
```


```python
# 품종별로 사용자 정의함수 peak_to_peak_ratio 연산 적용
igr.agg(peak_to_peak_ratio)

```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sepal_length</th>
      <th>sepal_width</th>
      <th>petal_length</th>
      <th>petal_width</th>
    </tr>
    <tr>
      <th>species</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>setosa</th>
      <td>1.348837</td>
      <td>1.913043</td>
      <td>1.900000</td>
      <td>6.000000</td>
    </tr>
    <tr>
      <th>versicolor</th>
      <td>1.428571</td>
      <td>1.700000</td>
      <td>1.700000</td>
      <td>1.800000</td>
    </tr>
    <tr>
      <th>virginica</th>
      <td>1.612245</td>
      <td>1.727273</td>
      <td>1.533333</td>
      <td>1.785714</td>
    </tr>
  </tbody>
</table>

</div>



#### agg() 메소드에 여러 함수 적용

**.agg([함수1, 함수2,...])**


```python
igr.agg([np.sum, np.mean])
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead tr th {
        text-align: left;
    }
    
    .dataframe thead tr:last-of-type th {
        text-align: right;
    }

</style>

<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="2" halign="left">sepal_length</th>
      <th colspan="2" halign="left">sepal_width</th>
      <th colspan="2" halign="left">petal_length</th>
      <th colspan="2" halign="left">petal_width</th>
    </tr>
    <tr>
      <th></th>
      <th>sum</th>
      <th>mean</th>
      <th>sum</th>
      <th>mean</th>
      <th>sum</th>
      <th>mean</th>
      <th>sum</th>
      <th>mean</th>
    </tr>
    <tr>
      <th>species</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>setosa</th>
      <td>250.3</td>
      <td>5.006</td>
      <td>171.4</td>
      <td>3.428</td>
      <td>73.1</td>
      <td>1.462</td>
      <td>12.3</td>
      <td>0.246</td>
    </tr>
    <tr>
      <th>versicolor</th>
      <td>296.8</td>
      <td>5.936</td>
      <td>138.5</td>
      <td>2.770</td>
      <td>213.0</td>
      <td>4.260</td>
      <td>66.3</td>
      <td>1.326</td>
    </tr>
    <tr>
      <th>virginica</th>
      <td>329.4</td>
      <td>6.588</td>
      <td>148.7</td>
      <td>2.974</td>
      <td>277.6</td>
      <td>5.552</td>
      <td>101.3</td>
      <td>2.026</td>
    </tr>
  </tbody>
</table>

</div>




```python
igr.agg(['sum', 'mean'])
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead tr th {
        text-align: left;
    }
    
    .dataframe thead tr:last-of-type th {
        text-align: right;
    }

</style>

<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="2" halign="left">sepal_length</th>
      <th colspan="2" halign="left">sepal_width</th>
      <th colspan="2" halign="left">petal_length</th>
      <th colspan="2" halign="left">petal_width</th>
    </tr>
    <tr>
      <th></th>
      <th>sum</th>
      <th>mean</th>
      <th>sum</th>
      <th>mean</th>
      <th>sum</th>
      <th>mean</th>
      <th>sum</th>
      <th>mean</th>
    </tr>
    <tr>
      <th>species</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>setosa</th>
      <td>250.3</td>
      <td>5.006</td>
      <td>171.4</td>
      <td>3.428</td>
      <td>73.1</td>
      <td>1.462</td>
      <td>12.3</td>
      <td>0.246</td>
    </tr>
    <tr>
      <th>versicolor</th>
      <td>296.8</td>
      <td>5.936</td>
      <td>138.5</td>
      <td>2.770</td>
      <td>213.0</td>
      <td>4.260</td>
      <td>66.3</td>
      <td>1.326</td>
    </tr>
    <tr>
      <th>virginica</th>
      <td>329.4</td>
      <td>6.588</td>
      <td>148.7</td>
      <td>2.974</td>
      <td>277.6</td>
      <td>5.552</td>
      <td>101.3</td>
      <td>2.026</td>
    </tr>
  </tbody>
</table>

</div>



### 2) apply( )

: 어떤 함수나 적용 가능

**Top3 산출**

- petal_length 기준으로 Top3 항목 선택


```python
def top3_petal_length(df):
    return df.sort_values(by="petal_length", ascending=False)[:3] 

# 함수 반환값이 수치 집합
```

- 품종별로 petal_length 기준의 Top3


```python
iris.groupby(iris.species).apply(top3_petal_length)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>sepal_length</th>
      <th>sepal_width</th>
      <th>petal_length</th>
      <th>petal_width</th>
      <th>species</th>
    </tr>
    <tr>
      <th>species</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="3" valign="top">setosa</th>
      <th>24</th>
      <td>4.8</td>
      <td>3.4</td>
      <td>1.9</td>
      <td>0.2</td>
      <td>setosa</td>
    </tr>
    <tr>
      <th>44</th>
      <td>5.1</td>
      <td>3.8</td>
      <td>1.9</td>
      <td>0.4</td>
      <td>setosa</td>
    </tr>
    <tr>
      <th>23</th>
      <td>5.1</td>
      <td>3.3</td>
      <td>1.7</td>
      <td>0.5</td>
      <td>setosa</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">versicolor</th>
      <th>83</th>
      <td>6.0</td>
      <td>2.7</td>
      <td>5.1</td>
      <td>1.6</td>
      <td>versicolor</td>
    </tr>
    <tr>
      <th>77</th>
      <td>6.7</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>1.7</td>
      <td>versicolor</td>
    </tr>
    <tr>
      <th>72</th>
      <td>6.3</td>
      <td>2.5</td>
      <td>4.9</td>
      <td>1.5</td>
      <td>versicolor</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">virginica</th>
      <th>118</th>
      <td>7.7</td>
      <td>2.6</td>
      <td>6.9</td>
      <td>2.3</td>
      <td>virginica</td>
    </tr>
    <tr>
      <th>117</th>
      <td>7.7</td>
      <td>3.8</td>
      <td>6.7</td>
      <td>2.2</td>
      <td>virginica</td>
    </tr>
    <tr>
      <th>122</th>
      <td>7.7</td>
      <td>2.8</td>
      <td>6.7</td>
      <td>2.0</td>
      <td>virginica</td>
    </tr>
  </tbody>
</table>

</div>



- agg( )는 반환값이 수치스칼라인 경우만 사용 가능
- apply()는 반환값이 수치 집합인 경우 적용 가능


```python
# iris.groupby(iris.species).agg(top3_petal_length) 
# 반환값이 수치 스칼라인 경우 적용 가능한데 반환값이 수치 집합 이므로 에러 발생
```

- 품종별로 최대값과 최소값 비중


```python
iris.groupby(iris.species).apply(peak_to_peak_ratio) 
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sepal_length</th>
      <th>sepal_width</th>
      <th>petal_length</th>
      <th>petal_width</th>
    </tr>
    <tr>
      <th>species</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>setosa</th>
      <td>1.348837</td>
      <td>1.913043</td>
      <td>1.900000</td>
      <td>6.000000</td>
    </tr>
    <tr>
      <th>versicolor</th>
      <td>1.428571</td>
      <td>1.700000</td>
      <td>1.700000</td>
      <td>1.800000</td>
    </tr>
    <tr>
      <th>virginica</th>
      <td>1.612245</td>
      <td>1.727273</td>
      <td>1.533333</td>
      <td>1.785714</td>
    </tr>
  </tbody>
</table>

</div>



**수치형자료를 대,중,소 3범주를 갖는 범주형으로 변환 : qcut()**


```python
def q3cut(s):
    return pd.qcut(s, 3, labels=["소", "중", "대"]).astype(str)
```

**품종별로 petal_length를 대,중,소 3범주로 변환**


```python
iris.groupby(iris.species).petal_length.apply(q3cut)
```




    0      소
    1      소
    2      소
    3      중
    4      소
          ..
    145    소
    146    소
    147    소
    148    중
    149    소
    Name: petal_length, Length: 150, dtype: object



**품종별로 petal_length를 대,중,소 3범주로 변환된 값을 petal_length_class변수로 추가** 


```python
iris["petal_length_class"] = iris.groupby(iris.species).petal_length.apply(q3cut)
iris.head(10)
iris.tail(10)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sepal_length</th>
      <th>sepal_width</th>
      <th>petal_length</th>
      <th>petal_width</th>
      <th>species</th>
      <th>petal_length_class</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>5.1</td>
      <td>3.5</td>
      <td>1.4</td>
      <td>0.2</td>
      <td>setosa</td>
      <td>소</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4.9</td>
      <td>3.0</td>
      <td>1.4</td>
      <td>0.2</td>
      <td>setosa</td>
      <td>소</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4.7</td>
      <td>3.2</td>
      <td>1.3</td>
      <td>0.2</td>
      <td>setosa</td>
      <td>소</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4.6</td>
      <td>3.1</td>
      <td>1.5</td>
      <td>0.2</td>
      <td>setosa</td>
      <td>중</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5.0</td>
      <td>3.6</td>
      <td>1.4</td>
      <td>0.2</td>
      <td>setosa</td>
      <td>소</td>
    </tr>
    <tr>
      <th>5</th>
      <td>5.4</td>
      <td>3.9</td>
      <td>1.7</td>
      <td>0.4</td>
      <td>setosa</td>
      <td>대</td>
    </tr>
    <tr>
      <th>6</th>
      <td>4.6</td>
      <td>3.4</td>
      <td>1.4</td>
      <td>0.3</td>
      <td>setosa</td>
      <td>소</td>
    </tr>
    <tr>
      <th>7</th>
      <td>5.0</td>
      <td>3.4</td>
      <td>1.5</td>
      <td>0.2</td>
      <td>setosa</td>
      <td>중</td>
    </tr>
    <tr>
      <th>8</th>
      <td>4.4</td>
      <td>2.9</td>
      <td>1.4</td>
      <td>0.2</td>
      <td>setosa</td>
      <td>소</td>
    </tr>
    <tr>
      <th>9</th>
      <td>4.9</td>
      <td>3.1</td>
      <td>1.5</td>
      <td>0.1</td>
      <td>setosa</td>
      <td>중</td>
    </tr>
  </tbody>
</table>

</div>






<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sepal_length</th>
      <th>sepal_width</th>
      <th>petal_length</th>
      <th>petal_width</th>
      <th>species</th>
      <th>petal_length_class</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>140</th>
      <td>6.7</td>
      <td>3.1</td>
      <td>5.6</td>
      <td>2.4</td>
      <td>virginica</td>
      <td>중</td>
    </tr>
    <tr>
      <th>141</th>
      <td>6.9</td>
      <td>3.1</td>
      <td>5.1</td>
      <td>2.3</td>
      <td>virginica</td>
      <td>소</td>
    </tr>
    <tr>
      <th>142</th>
      <td>5.8</td>
      <td>2.7</td>
      <td>5.1</td>
      <td>1.9</td>
      <td>virginica</td>
      <td>소</td>
    </tr>
    <tr>
      <th>143</th>
      <td>6.8</td>
      <td>3.2</td>
      <td>5.9</td>
      <td>2.3</td>
      <td>virginica</td>
      <td>대</td>
    </tr>
    <tr>
      <th>144</th>
      <td>6.7</td>
      <td>3.3</td>
      <td>5.7</td>
      <td>2.5</td>
      <td>virginica</td>
      <td>중</td>
    </tr>
    <tr>
      <th>145</th>
      <td>6.7</td>
      <td>3.0</td>
      <td>5.2</td>
      <td>2.3</td>
      <td>virginica</td>
      <td>소</td>
    </tr>
    <tr>
      <th>146</th>
      <td>6.3</td>
      <td>2.5</td>
      <td>5.0</td>
      <td>1.9</td>
      <td>virginica</td>
      <td>소</td>
    </tr>
    <tr>
      <th>147</th>
      <td>6.5</td>
      <td>3.0</td>
      <td>5.2</td>
      <td>2.0</td>
      <td>virginica</td>
      <td>소</td>
    </tr>
    <tr>
      <th>148</th>
      <td>6.2</td>
      <td>3.4</td>
      <td>5.4</td>
      <td>2.3</td>
      <td>virginica</td>
      <td>중</td>
    </tr>
    <tr>
      <th>149</th>
      <td>5.9</td>
      <td>3.0</td>
      <td>5.1</td>
      <td>1.8</td>
      <td>virginica</td>
      <td>소</td>
    </tr>
  </tbody>
</table>

</div>



----------------------------------------

## 2-2 데이터 그룹의 변형 : transform()

### 데이터 변형의 일반적인 과정

: transform() 메소드는 데이터프레임의 **모든 값**에 함수를 적용하며, 다음의 특성을 갖는 새 데이터프레임을 반환한다

- 모든 그룹의 인덱스가 합쳐진 인덱스를 갖는다
- row의 개수는 모든 그룹의 row 개수의 총합과 같다
- 그룹화 대상이 아닌 컬럼도 함수가 성공적으로 적용된다면 결과에 포함되며, 그렇지 않은 컬럼은 삭제될 수 있다

**예제 데이터1**


```python
trans_data = pd.DataFrame({'Label' : ['A','C','B','A','C'],
                           'Values': [0, 1, 2, 3, 4],
                           'Values2' : [5, 6, 7, 8, 9],
                           'Other': ['foo','bar','baz','fiz','buz']},
                         index=list('VWXYZ'))
trans_data
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Label</th>
      <th>Values</th>
      <th>Values2</th>
      <th>Other</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>V</th>
      <td>A</td>
      <td>0</td>
      <td>5</td>
      <td>foo</td>
    </tr>
    <tr>
      <th>W</th>
      <td>C</td>
      <td>1</td>
      <td>6</td>
      <td>bar</td>
    </tr>
    <tr>
      <th>X</th>
      <td>B</td>
      <td>2</td>
      <td>7</td>
      <td>baz</td>
    </tr>
    <tr>
      <th>Y</th>
      <td>A</td>
      <td>3</td>
      <td>8</td>
      <td>fiz</td>
    </tr>
    <tr>
      <th>Z</th>
      <td>C</td>
      <td>4</td>
      <td>9</td>
      <td>buz</td>
    </tr>
  </tbody>
</table>

</div>



**Label 컬럼으로 그룹화**


```python
groups = trans_data.groupby('Label')
groups
```




    <pandas.core.groupby.generic.DataFrameGroupBy object at 0x0000024A8A2DE8B0>




```python
print_groups(groups)
```

    A
      Label  Values  Values2 Other
    V     A       0        5   foo
    Y     A       3        8   fiz
    B
      Label  Values  Values2 Other
    X     B       2        7   baz
    C
      Label  Values  Values2 Other
    W     C       1        6   bar
    Z     C       4        9   buz



```python
groups.groups
```




    {'A': ['V', 'Y'], 'B': ['X'], 'C': ['W', 'Z']}



### 각 값에 10을 더하는 함수를 적용해 데이터프레임 변형 수행


```python
groups.transform(lambda x:x+10)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Values</th>
      <th>Values2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>V</th>
      <td>10</td>
      <td>15</td>
    </tr>
    <tr>
      <th>W</th>
      <td>11</td>
      <td>16</td>
    </tr>
    <tr>
      <th>X</th>
      <td>12</td>
      <td>17</td>
    </tr>
    <tr>
      <th>Y</th>
      <td>13</td>
      <td>18</td>
    </tr>
    <tr>
      <th>Z</th>
      <td>14</td>
      <td>19</td>
    </tr>
  </tbody>
</table>

</div>



-> 'Label'과 'Other' 컬럼은 문자열 값들이므로 함수 적용에 실패하여 두 컬럼은 결과에서 제외됨

### 그룹의 평균으로 결측값 채우기

**예제 데이터2**


```python
trans_data2 = pd.DataFrame({'Label' : list('ABABAB'),
                            'Values' : [10, 20, 11, np.nan, 12, 22]})
trans_data2
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Label</th>
      <th>Values</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>A</td>
      <td>10.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>B</td>
      <td>20.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>A</td>
      <td>11.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>B</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>A</td>
      <td>12.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>B</td>
      <td>22.0</td>
    </tr>
  </tbody>
</table>

</div>




```python
groups= trans_data2.groupby('Label')
groups.groups
print_groups(groups)
```




    {'A': [0, 2, 4], 'B': [1, 3, 5]}



    A
      Label  Values
    0     A    10.0
    2     A    11.0
    4     A    12.0
    B
      Label  Values
    1     B    20.0
    3     B     NaN
    5     B    22.0


**각 그룹의 평균 계산**


```python
groups.mean()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Values</th>
    </tr>
    <tr>
      <th>Label</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>A</th>
      <td>11.0</td>
    </tr>
    <tr>
      <th>B</th>
      <td>21.0</td>
    </tr>
  </tbody>
</table>

</div>



**결측치(Nan) 채우기**

- 그룹별 평균으로 채우기


```python
fillna = groups.transform(lambda x : x.fillna(x.mean()))
fillna
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Values</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>10.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>20.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>11.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>21.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>12.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>22.0</td>
    </tr>
  </tbody>
</table>

</div>



## 2-3 그룹 필터링 : filter()

- 데이터그룹을 선택적으로 삭제

**예제 데이터3**


```python
df3 = pd.DataFrame({'Label' : list('AABCCC'),
                    'Values' : [1, 2, 3, 4, np.nan, 8]})
df3
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Label</th>
      <th>Values</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>A</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>A</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>B</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>C</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>C</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>5</th>
      <td>C</td>
      <td>8.0</td>
    </tr>
  </tbody>
</table>

</div>



**아이템의 개수가 지정한 최소한의 수를 넘지 않는 그룹을 제외**


```python
df3.groupby('Label').filter(lambda x:x.Values.count() > 1)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Label</th>
      <th>Values</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>A</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>A</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>C</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>C</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>5</th>
      <td>C</td>
      <td>8.0</td>
    </tr>
  </tbody>
</table>

</div>



**NaN이 하나라도 존재하는 그룹 제외**


```python
df3.groupby('Label').filter(lambda x:x.Values.isnull().sum() == 0)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Label</th>
      <th>Values</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>A</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>A</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>B</td>
      <td>3.0</td>
    </tr>
  </tbody>
</table>

</div>



**전체 데이터셋 평균과의 차이가 2.0이 넘는 그룹 평균을 가진 그룹만 필터링**


```python
df3.groupby('Label').mean()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Values</th>
    </tr>
    <tr>
      <th>Label</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>A</th>
      <td>1.5</td>
    </tr>
    <tr>
      <th>B</th>
      <td>3.0</td>
    </tr>
    <tr>
      <th>C</th>
      <td>6.0</td>
    </tr>
  </tbody>
</table>

</div>




```python
gmean = df3.groupby('Label').mean().mean()
```


```python
df3.groupby('Label').filter(lambda x: (x.Values.mean()- gmean) > 2.0)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Label</th>
      <th>Values</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3</th>
      <td>C</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>C</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>5</th>
      <td>C</td>
      <td>8.0</td>
    </tr>
  </tbody>
</table>

</div>

